var app={initialize:function(){this.bindEvents()},bindEvents:function(){document.addEventListener("deviceready",this.onDeviceReady,!1)},onDeviceReady:function(){app.receivedEvent("deviceready")},receivedEvent:function(a){console.log("Received Event: "+a)}};window.onerror=function(a,b,c){console.log("SCError: "+a+" in "+b+" at line "+c)};var checkPhoneGap=function(){return"undefined"!=typeof cordova||"undefined"!=typeof phonegap},isPhoneGap=checkPhoneGap(),testing=!1,testRequestID=112669,testPhoneNumber="(301) 704-7437",skipAPICalls=!1,testingType="",environment="production",root,api_root,mapsLoaded=!1,appOptions={analytics:{gaStorageName:"sc_clientId",app:{iPhone:{"Google Analytics Property Name":"Seva Call Consumer iPhone App v2",gaID:"UA-9179910-16"},Android:{"Google Analytics Property Name":"Seva Call Consumer Android App v2",gaID:"UA-9179910-17"}},web:{"Google Analytics Property Name":"Seva Call Consumer Mobile Web v2",gaID:"UA-9179910-18"},eventTypes:{"default":"notify",1:"page",2:"interaction",3:"alert"}}},alerts={call_companies:{body:"Call companies now? You may receive up to three calls"},home:{title:"Start Over?",body:"Returning to step 1 will cancel your current request, continue?"},abandon:{title:"Start Over?",body:"Are you sure you want to abandon this request?"}};"local"!=environment||isPhoneGap?"local"==environment&&isPhoneGap?(root="",api_root="http://test.s17.sevacall.com/"):"development"==environment?(root=isPhoneGap?"":"http://test.s17.sevacall.com/mobile/",api_root="http://test.s17.sevacall.com/"):"production"==environment&&(console.log=function(){},console.warn=function(){},console.error=function(){},root="",api_root=isPhoneGap?"http://www.talklocal.com/":"../"):(root="",api_root="http://localhost/"),String.prototype.capitalize=function(){return this.toLowerCase().replace(/^.|\s\S/g,function(a){return a.toUpperCase()})};var myApp=angular.module("myApp",["myApp.services","myApp.directives","myApp.controllers","ui.router","ngAnimate","ngStorage"]).factory("MyInterceptor",["$q","$rootScope","$injector","$timeout","Overlay",function(a,b,c,d,e){var f=0;console.log("http interceptor");var g=function(b){var d=function(){c.get("Track").event(3,"alert_internet_failed")};return b.then(function(b){if(console.log("*--*Http Wrapper Success Response: ",b),b.data&&"string"==typeof b.data&&-1!=b.data.indexOf("DOCTYPE")){var f=a.defer();return d(),new xAlert("Verify you are connected to the internet and retry.",function(d){if(1==d){var f=c.get("$http");return f(b.config)}e.remove(),a.reject("rejected")},"Connection Error","Retry, Cancel"),f.promise}return console.log("*Response was valid and we're connected to the internet... returning"),b},function(b){if(console.log("-*-Http wrapper error response: ",b),500==b.status,f>=2){f=0;var g=a.defer();return d(),new xAlert("Verify you are connected to the internet and retry.",function(d){if(1==d){var f=c.get("$http");return f(b.config)}e.remove(),a.reject("rejected")},"Connection Error","Retry, Cancel"),g.promise}f++;var h=c.get("$http");return h(b.config)})};return g}]).config(["$httpProvider",function(a){a.responseInterceptors.push("MyInterceptor")}]).config(["$httpProvider",function(a){a.defaults.transformRequest=function(a){return void 0===a?a:$.param(a)}}]).config(["$httpProvider",function(a){a.responseInterceptors.push(["$q","$rootScope",function(a,b){return function(c){return b.$broadcast("event:routeChangeStart"),c.then(function(a){return b.$broadcast("event:routeChangeSuccess"),a},function(c){return b.$broadcast("event:routeChangeError"),a.reject(c)})}}])}]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/step1");var c={name:"step1",url:"/step1",controller:"step1Controller",templateUrl:root+"views/home.html"},d={name:"step2",url:"/step2",controller:"step2Controller",templateUrl:root+"views/step2.html",resolve:{resolveAPI:["Overlay","$q","SCAPI","$location","Request",function(a,b,c,d,e){if(e.id)return!0;var f=b.defer();return a.add(1),c.step1().then(function(b){"Invalid Location"==b&&(console.log("-*-Invalid step 2"),d.path("/")),a.remove(),f.resolve(b)}),f.promise}]}},e={name:"step3",url:"/step3",controller:"step3Controller",templateUrl:root+"views/step3.html"},f={name:"recording",url:"/recording",controller:"recordingController",templateUrl:root+"views/recording.html"},g={name:"timetable",url:"/timetable",controller:"timeTableController",templateUrl:root+"views/timetable.html"},h={name:"step2a",url:"/step2a",controller:"step2aController",templateUrl:root+"views/step2a.html"},i={name:"settings",url:"/settings",controller:"step2aController",templateUrl:root+"views/step2a.html"},j={name:"information",url:"/information",controller:"informationController",templateUrl:root+"views/information.html",resolve:{resolveSize:[function(){var a=$(".ui-view-container").width(),b=parseInt(a/16*9)+2,c={height:b+"px","max-height":"400px"};return 400>b?c={width:"100%"}:(b=400,a=b/9*16,c={width:a+"px"}),[b,a,c]}]}},k={name:"summary",url:"/summary",controller:"summaryController",templateUrl:root+"views/summary.html"};a.state(c),a.state(d),a.state(e),a.state(f),a.state(k),a.state(g),a.state(h),a.state(i),a.state(j)}]).run(["Storage","SCAPI","Request","$rootScope","Menu","$state","$urlRouter","$window","$location","Nav","AlertSwitch",function(a,b,c,d,e,f,g,h,i,j,k){FastClick.attach(document.body),d.settingsCompletedOnce={name:!1,email:!1,phone:!1},d.$on("requestCompleted",[function(){console.warn("SC-Deprecated: rootScope broadcast('requestCompleted')"),f.go("summary")}]),d.$on("$stateChangeStart",function(a,b){function d(){console.log("*-*Preventing default change on state change Menu Button"),a.preventDefault();var d=function(){c.reset(),f.go(b.name),g.sync()};return k.on?(new xAlert(alerts.abandon.body,function(a){1==a&&d()},alerts.abandon.title,"Yes, Cancel"),!1):void d()}return console.log("-Going to state: "+b.name),"step2"!=b.name&&"step3"!=b.name||c.id||i.path("/step1"),c.id&&!c.complete&&"step1"==b.name?d():(e.close(),void console.log("*Menu closed"))}),d.$on("$locationChangeStart",function(a,b){function d(){return console.log("*-*Preventing default change on location change Back Button"),a.preventDefault(),k.on?(new xAlert(alerts.abandon.body,function(a){1==a&&e()},alerts.abandon.title,"Yes, Cancel"),!1):void e()}var e=function(){c.reset(),f.go("step1"),g.sync()};return c.id&&!c.complete&&-1!=b.indexOf("step1")?d():void(-1==b.indexOf("step3")&&-1==b.indexOf("step2")||c.id||i.path("/step1"))})}]).filter("orderObjectBy",[function(){return function(a,b,c){var d=[];return angular.forEach(a,function(a){d.push(a)}),d.sort(function(a,c){return a[b]>c[b]}),c&&d.reverse(),d}}]).filter("reverse",[function(){return function(a){return a.slice().reverse()}}]);if(myApp.factory("RequestSubmittor",["$q","Overlay","Request","$state","Times","User","Recording","$timeout","Uploader","$http","SCAPI",function(a,b,c,d,e,f,g,h,i,j,k){var l={step1:function(){var e=a.defer();return skipAPICalls?(c.setID(testRequestID),d.go("step2"),e.resolve(),e.promise):(b.add(1),console.log("SCAPI: ",k),k.step1().then(function(a){b.remove(),console.log("*Step 1 Returned: ",a);a.split("|");return-1==a.indexOf("requestID|")?(new xAlert(a),!1):(e.resolve(a),void d.go("step2"))}),e.promise)},step2:function(){function h(){c.submit().then(function(){b.remove(),d.go("step3"),k.resolve()},function(){k.reject()})}var k=a.defer();return skipAPICalls?(c.setDescription("This is a test description set by the skip API Calls variable"),e.buttons={now:!0},c.submit().then(function(){b.remove(),d.go("step3"),k.resolve()})):g.saved||c.isDescriptionValid()?e.isEmpty()?(new xAlert("Please select a time"),k.reject()):f.isEmailValid()&&f.isNameValid()&&f.isPhoneValid()?new xAlert(alerts.call_companies.body,function(a){2==a&&(b.add(1),g.saved?(b.message("Uploading Recording..."),i.uploadRecording(g.toURL,{audioType:g.audioType,reqID:c.id}).then(function(){console.log("*Audio Uploaded"),b.message("Encoding Recording..."),j({url:api_root+"api/mobile/v2/encodeAudio.php?audioType="+g.audioType+"&requestID="+c.id,method:"GET",headers:{"Content-Type":"application/json"}}).success(function(a){console.log("*Audio Encoding returned: "+a),b.message("Preparing Request..."),h()}).error(function(){new xAlert("Error Encoding Recording")})},function(){b.remove(),k.reject()})):(b.message("Preparing Request..."),h()))},"Alert","Cancel,Ok"):(d.go("step2a"),k.resolve()):(new xAlert("Description must be 7 words"),k.reject()),k.promise}};return l}]),myApp.factory("SCAPI",["Times","Recording","$timeout","User","$http","$q","Track",function(a,b,c,d,e,f,g){var h={init:function(a){this.Request=a},busy:!1,urls:{step1:api_root+"api/mobile/v2/searchAction1.php",getCompaniesList:api_root+"api/mobile/v2/getCompaniesList.php",seachAction3:api_root+"api/mobile/v2/searchAction3.php",getRequestStatus:api_root+"api/mobile/v4/request/status",getYelpRating:api_root+"api/mobile/v2/getRating.php?source=yelp",getCitysearchRating:api_root+"api/mobile/v2/getRating.php?source=citysearch",getGoogleRating:api_root+"api/mobile/v2/getRating.php?source=google",getRating:api_root+"api/mobile/v2/getRating.php",timeSaved:api_root+"api/mobile/v4/request/time_saved"},data:{key:"tmp",boxType:"get",demoNumber:"3018764913"},step1:function(){var a=this,b=f.defer();a.data.category_short=a.Request.category,a.data.search_location=d.zipcode;var c=a.postifyUrl(a.urls.step1);return e({url:c,method:"GET",headers:{"Content-Type":"application/json"}}).success(function(c){a.busy=!1;var d=c.split("|");a.Request.setID(d[1]),console.log("*-*Set Request ID For SCAPI to: "+a.Request.id+"*-*"),b.resolve(c)}).error(function(){a.busy=!1,b.reject(!1)}),b.promise},getCompaniesList:function(){var a=this,b=a.postifyUrl(a.urls.getCompaniesList),c=f.defer();return e({url:b,method:"GET",headers:{"Content-Type":"application/json"}}).success(function(b){var d=b.split("|"),e=d.length-1;console.log("*Retrieved "+e+" companies in the CompanyList:"),e&&g.event("notify_company_list_success");for(var f=0;e>f;f++){console.log("*CompanyNodes: "+d);var h=d[f].split("^~^");a.Request.companies[h[0]]=new Object({name:h[1],id:h[0],lat:h[2],lon:h[3],addr:h[4],city:h[5].capitalize(),state:h[6],zip:h[7],phone:h[8],markerNumber:f+1,status:"none",marker:new Object,infoBox:new Object,infoBoxEvent:function(){},ratingYelp:0,isYelpLoaded:0,numRatingsYelp:"",ratingCitysearch:0,isCitysearchLoaded:!1,numRatingsCitysearch:"",ratingGoogle:0,isGoogleLoaded:0,numRatingsGoogle:"",reviewsLoaded:0,reviewsHTML:"",accepted:0,visible:0,acceptedOrder:0})}console.log("*Companies for this request are:",a.Request.companies),c.resolve(b)}).error(function(a){console.log("*GetCompaniesList error:",a),c.resolve(a)}),c.promise},postifyUrl:function(a){var c=this;window.device&&window.device.platform&&(c.data.medium=window.device.platform),c.data.description=b.saved?"Describe what you need help with in as much detail as possible...":c.Request.description,c.data.requestID=c.Request.id;var d=a+"?"+$.param(c.data);return d},postifyUser:function(){var a=angular.copy(d.phone);a=String(parseInt(a.replace(/[)( -]/g,"")));var b=a.substring(0,3),c=a.substring(3,6),e=a.substring(6,10),f={name:d.name,email:d.email,phone1:b,phone2:c,phone3:e};return $.param(f)},generateURL:function(b){var c,d=this;return"searchAction3"==b&&(c=d.postifyUrl(d.urls.seachAction3)+"&"+d.postifyUser()+a.postify()),c},searchAction3:function(){var a=this;a.data.requestID=a.Request.id;var b=f.defer(),d=a.generateURL("searchAction3");return console.log("SCAPI.searchAction3 is processing with this url: ",d),testing?c(function(){b.resolve(!0)},2e3):e({url:d,method:"GET",headers:{"Content-Type":"application/json"}}).success(function(a){b.resolve(a)}).error(function(a){b.resolve(a)}),b.promise},timeSaved:function(){var a=this;a.data.requestID=a.Request.id;var b=a.postifyUrl(a.urls.timeSaved),c=f.defer();return e({url:b,method:"GET",headers:{"Content-Type":"application/json"}}).success(function(a){c.resolve(a.data)}).error(function(a){console.log("*TimeSaved error:",a),c.resolve(a)}),c.promise},setRequestStatus:function(a){this.Request.setStatuses(a)},getRequestStatus:function(){var a=this,b=a.postifyUrl(a.urls.getRequestStatus),c=f.defer();return a.Request.requestStatusOverride?c.resolve(a.Request.requestStatusOverride.data):e({url:b,method:"GET",headers:{"Content-Type":"application/json"}}).success(function(a){c.resolve(a.data)}).error(function(a){console.log("*GetRequestStatus error:",a),c.resolve(a)}),c.promise},getRatings:function(a){function b(){var b={companyName:a.name,companyZipcode:a.zip,companyPhone:a.phone};return $.param(b)}function c(a){var c=f.defer(),d=g.urls.getRating+"?source="+a+"&"+b();return e({url:d,method:"GET",headers:{"Content-Type":"application/json"}}).success(function(a){c.resolve(a),i.successes++;{var b=a.split("|");b[0],b[1]}}).error(function(a){i.errors++,c.reject(),console.log("*GetRating error: "+a)}),c.promise}function d(){console.log("GOT RATING WITH RESPONSES OBJECT == ",i),i.errors+i.successes==i.max&&(i.errors>0?h.reject():h.resolve(!0))}var g=this,h=f.defer(),i={errors:0,successes:0,max:3};return c("yelp").then(function(b){var c=b.split("|");a.ratingYelp=c[0]>0?c[0]:0,a.numRatingsYelp=c[1],a.yelpStarOffset=-4.66+12.66*c[0],a.isYelpLoaded=1,d()}),c("citysearch").then(function(b){var c=b.split("|"),e=b[0];e=Math.floor(e)+(Math.round(e-Math.floor(e))?.5:0),a.ratingCitysearch=e;var f=-4.66+12.66*e;a.citysearchStarOffset=f,a.numRatingsCitysearch=c[1],a.isCitysearchLoaded=1,d()}),c("google").then(function(b){var c=b.split("|");a.ratingGoogle=c[0]>0?c[0]:0,a.googleStarOffset=-4.66+12.66*c[0],a.numRatingsGoogle=c[1],a.isGoogleLoaded=1,d()}),h.promise}};return h}]),myApp.factory("Test",["RequestSubmittor","$q","Times","User","Request","SCAPI","Recording","$state","$timeout","AlertSwitch",function(a,b,c,d,e,f,g,h,i,j){var k=function(){};return k.prototype={requestStatusOverrides:{one:'{"status":"success","data":[{"requestStatusID":"1876989","requestStatus":"ONE Thomas Plumbing Co Called ","companyID":"495861","requestStatusShort":"Calling"},{"requestStatusID":"1876990","requestStatus":"O\'Neill Plumbing Called ","companyID":"495866","requestStatusShort":"Calling"},{"requestStatusID":"1876991","requestStatus":"Geeks On-site Called ","companyID":"11930881","requestStatusShort":"Calling"},{"requestStatusID":"1876992","requestStatus":"Thomas Plumbing Co -... Called ","companyID":"12013570","requestStatusShort":"Calling"},{"requestStatusID":"1876993","requestStatus":"Thomas Plumbing Co Answered ","companyID":"495861","requestStatusShort":"Answered"},{"requestStatusID":"1876994","requestStatus":"Thomas Plumbing Co -... Answered ","companyID":"12013570","requestStatusShort":"Answered"},{"requestStatusID":"1876995","requestStatus":"O\'Neill Plumbing Answered ","companyID":"495866","requestStatusShort":"Answered"},{"requestStatusID":"1876996","requestStatus":"Geeks On-site Answered ","companyID":"11930881","requestStatusShort":"Answered"},{"requestStatusID":"1876997","requestStatus":"O\'Neill Plumbing Call Completed ","companyID":"495866","requestStatusShort":"Hung Up"},{"requestStatusID":"1876998","requestStatus":"Thomas Plumbing Co -... Call Completed ","companyID":"12013570","requestStatusShort":"Hung Up"},{"requestStatusID":"1876999","requestStatus":"Thomas Plumbing Co Call Completed ","companyID":"495861","requestStatusShort":"Hung Up"},{"requestStatusID":"1877000","requestStatus":"Geeks On-site Call Completed ","companyID":"11930881","requestStatusShort":"Hung Up"},{"requestStatusID":"1877001","requestStatus":"Request Completed","companyID":"0","requestStatusShort":"Completed"}]}',two:'{"status":"success","data":[{"requestStatusID":"1876989","requestStatus":"Thomas Plumbing Co Called ","companyID":"495861","requestStatusShort":"T2 Calling"},{"requestStatusID":"1876990","requestStatus":"TESTING TWO O\'Neill Plumbing Called ","companyID":"495866","requestStatusShort":"T2 Calling"},{"requestStatusID":"1876991","requestStatus":"TESTING TWO Geeks On-site Called ","companyID":"11930881","requestStatusShort":"T2 Calling"},{"requestStatusID":"1876992","requestStatus":"TESTING TWO Thomas Plumbing Co -... Called ","companyID":"12013570","requestStatusShort":"T2 Calling"},{"requestStatusID":"1876993","requestStatus":"Thomas Plumbing Co Answered ","companyID":"495861","requestStatusShort":"T2 Answered"},{"requestStatusID":"1876994","requestStatus":"Thomas Plumbing Co -... Answered ","companyID":"12013570","requestStatusShort":"T2 Answered"},{"requestStatusID":"1876995","requestStatus":"TESTING TWO O\'Neill Plumbing Answered ","companyID":"495866","requestStatusShort":"T2 Answered"},{"requestStatusID":"1876996","requestStatus":"TESTING TWO Geeks On-site Answered ","companyID":"11930881","requestStatusShort":"T2 Answered"},{"requestStatusID":"1876997","requestStatus":"TESTING TWO O\'Neill Plumbing Call Completed ","companyID":"495866","requestStatusShort":"T2 Hung Up"},{"requestStatusID":"1876998","requestStatus":"TESTING TWO Thomas Plumbing Co -... Call Completed ","companyID":"12013570","requestStatusShort":"T2 Hung Up"},{"requestStatusID":"1876999","requestStatus":"TESTING TWO Thomas Plumbing Co Call Completed ","companyID":"495861","requestStatusShort":"T2 Hung Up"},{"requestStatusID":"1877000","requestStatus":"Geeks On-site Call Completed ","companyID":"11930881","requestStatusShort":"T2 Hung Up"},{"requestStatusID":"1877001","requestStatus":"Request Completed","companyID":"0","requestStatusShort":"Completed"}]}'},test1:function(){g.saved=!0,d.setZipcode("20861"),e.setCategory("Test Spin"),c.timesActive=["4-1","2-3"],c.buttons={now:!0};var a=f.generateURL("searchAction3");console.log("*SearchAction3 Test URL: "+a)},test2:function(){var a=function(a){a.root.getFile("sc_recording3.wav",{create:!0,exclusive:!1},function(a){console.log("*****SOURCE: "+a.fullPath),g.src=a.toURL(),g.mediaRec=new Media(g.src,function(){alert("OK")},function(a){console.log("MediaError callback code: "+a.code),console.log("MediaError callback message: "+a.message),alert("NOT OK")},function(){}),g.mediaRec.startRecord(),alert("RECORDING"),window.setTimeout(function(){g.mediaRec.stopRecord()},1e3),window.setTimeout(function(){alert("PLAYING"),g.mediaRec.release();var a=new Media(g.src);a.play()},1500)},function(){alert("fail")})};window.requestFileSystem(LocalFileSystem.TEMPORARY,0,a,function(){})},setTestParams:function(){skipAPICalls=!0,d.setZipcode("20010"),e.setCategory("Test Spin"),c.timesActive=["4-1","2-3"],c.buttons={now:!0},d.setName("Augie Testing Via Test Service"),d.setEmail("Augie@a.co"),d.setPhone("3017047437")},test3:function(){var b=this;this.setTestParams(),j.turnOff(),e.setID(testRequestID),e.setRequestStatusOverride(b.requestStatusOverrides.two),a.step1().then(a.step2().then(function(){i(function(){h.go("step1"),i(function(){e.setRequestStatusOverride(b.requestStatusOverrides.one),a.step1().then(a.step2())},1e3)},1e3)}))}},new k}]),angular.module("myApp.services",[]),myApp.factory("App",[function(){var a={loaded:!1};return a}]),myApp.factory("TwitterService",["Track",function(a){var b={initialized:!1,init:function(){this.initialized||(this.initialized=!0,window.twttr=function(a,b,c){var d,e,f=a.getElementsByTagName(b)[0];if(!a.getElementById(c))return e=a.createElement(b),e.id=c,e.src="https://platform.twitter.com/widgets.js",f.parentNode.insertBefore(e,f),window.twttr||(d={_e:[],ready:function(a){d._e.push(a)}})}(document,"script","twitter-wjs"),window.twttr.ready(function(){twttr.events.bind("tweet",function(){a.event(2,"twitter_share_completed",!0)})}))}};return b}]),myApp.factory("AnimationService",[function(){var a={initialized:!1,init:function(){this.initialized=!0}};return a}]),myApp.factory("RecordingModal",["Storage","$timeout",function(a,b){var c={active:!1,removing:!1,removed:!1,hasBeenActive:!1,message:"Click here to record your description.",show:function(){this.hasBeenActive||(this.active=!0),this.hasBeenActive=!0},hide:function(){var c=this;c.removing=!0,b(function(){c.removed=!0},500),a.recordingModalDismissed=!0,a.set()}};return c}]),myApp.factory("AlertSwitch",[function(){var a={on:!0,turnOff:function(){this.on=!1},turnOn:function(){this.on=!0}};return a}]),myApp.factory("Track",["$state",function(a){var b={GA_IDs:appOptions.analytics,init:function(){if(window.localStorage){var a,b,c,d=this.GA_IDs;window.device&&window.device.uuid?(a=window.device.uuid,"iOS"==window.device.platform&&(b=d.app.iPhone.gaID),"Android"==window.device.platform&&(b=d.app.Android.gaID),c="Mobile App",console.log("setting localStorage.clientId to: "+a),window.localStorage.setItem(appOptions.analytics.gaStorageName,a)):(b=d.web.gaID,c="Mobile Web",window.localStorage.getItem(appOptions.analytics.gaStorageName)?a=window.localStorage.getItem(appOptions.analytics.gaStorageName):(a=Math.round(2147483647*Math.random()),console.log("setting localStorage.clientId to: "+a),window.localStorage.setItem(appOptions.analytics.gaStorageName,a))),console.log("tracking to: "+c+" with client id: "+window.localStorage.getItem(appOptions.analytics.gaStorageName)),ga("create",b,{storage:"none",clientId:window.localStorage.getItem(appOptions.analytics.gaStorageName)}),ga(function(a){console.log("google tracker returned client id: "+a.get("clientId"))})}else ga("create",b,"www.sevacall.com");ga("send","pageview",{page:"step1"})},defaults:{event:{hitType:"event",eventCategory:"notify",eventAction:"none"}},page:function(a){var b={hitType:"pageview",page:a};console.log("--> TRACK_PAGEVIEW_: "+a.toUpperCase()),ga("send",b)},event:function(){var b=appOptions.analytics.eventTypes,c={};1==arguments.length&&"object"==typeof arguments[0]&&(c=arguments[0]),arguments.length>=2?(c.eventCategory=b[arguments[0]],c.eventAction=arguments[1]):(c.eventCategory=this.defaults.event.eventCategory,c.eventAction=arguments[0]),3==arguments.length&&(c.eventAction=a.current.name+"_"+c.eventAction);var d=this.defaults.event,e=$.extend({},d,c);e.eventAction=e.eventAction.toUpperCase();var f;window.localStorage&&(f=window.localStorage.getItem(appOptions.analytics.goStorageName)),console.log(" --> TRACK ACTION: "+e.eventAction.toUpperCase()),ga("send",e)}};return b}]),myApp.factory("MapLoader",["$window","$q",function(a,b){var c={busy:!1,loaded:!1,loadMaps:function(){var c=this;return c.deferred=b.defer(),c.busy?(console.log("*loadMaps was busy, waiting..."),c.deferred.reject()):c.loaded?(console.log("*loadMaps was loaded, resolving"),c.deferred.resolve()):(c.busy=!0,a.loadMapsPlugins=function(){$.getScript("scripts-get/infobox.js").done(function(){$.getScript("scripts-get/xMarker.js").done(function(){c.loaded=!0,c.busy=!1,c.deferred.resolve(!0)}).fail(function(){c.busy=!1,console.log("*getScript xMarker failed"),c.deferred.reject(!1)})}).fail(function(){console.log("*getScript infoBox failed"),c.busy=!1,c.deferred.reject(!1)})},$.getScript("http://maps.google.com/maps/api/js?v=3.13&key=AIzaSyBHtVxQeYDw2uzrMXpbkqnfqkftcjo-B3Y&sensor=false&callback=loadMapsPlugins").done(function(a,b){console.log("*Get google maps textStatus is: "+b),("object"!=typeof window.google||"object"!=typeof window.google.maps)&&(c.busy=!1,c.deferred.reject(!1))}).fail(function(){c.busy=!1,c.deferred.reject(!1)})),c.deferred.promise}};return c}]),myApp.factory("Nav",[function(){var a={direction:"back",reset:function(){this.direction="back"}};return a}]),myApp.factory("Menu",["$timeout","Track",function(a,b){var c={active:!1,busy:!1,toggle:function(){var c=this;if(!c.busy){c.active?b.event(2,"menu_closed",!0):b.event(2,"menu_opened",!0),a(function(){c.busy=!1},500),c.busy=!0;{$("#menu")[0].offsetHeight}c.active?c.close():c.active=!0}},close:function(){var b=this;b.active&&(b.busy=!0,a(function(){b.busy=!1},500),this.active=0)}};return c}]),myApp.factory("Ratings",["Request",function(){var a={getRating:function(a){api_root+"api/mobile/v2/getRating.php?source="+source+"&companyName="+encodeURIComponent(a.name)+"&companyZipcode="+encodeURIComponent(a.zip)+"&companyPhone="+encodeURIComponent(a.phone)}};return a}]),myApp.factory("GoogleMap",["Track","$timeout","$q","Request",function(a,b,c,d){var e={bounds:[],latLngList:[],init:function(){function b(){var a=c.defer(),b=new google.maps.Geocoder;return b.geocode({address:"20854"},function(b,c){c==google.maps.GeocoderStatus.OK&&a.resolve(b[0].geometry.location)}),a.promise}function e(){var a=c.defer();try{b().then(function(b){var c={center:b,zoom:8};f.map=new google.maps.Map(document.getElementById("map_canvas"),c),d.GoogleMap=f,google.maps.event.addListener(f.map,"idle",function(){$("style").remove()}),a.resolve(!0)})}catch(e){console.log(e),a.reject()}return a.promise}var f=this;e().then(function(){a.event(1,"map_loading_success",!0),f.mapFitBounds(),f.addMarkers()},function(){a.event(1,"map_loading_failed",!0)})},mapFitBounds:function(){var a=this;a.LatLngList=new Array,a.bounds=new google.maps.LatLngBounds;for(var b in d.companies){var c=new google.maps.LatLng(d.companies[b].lat,d.companies[b].lon);a.LatLngList.push(c),a.bounds.extend(c)}var e=10;a.map.initialZoom=!0,google.maps.event.addListener(a.map,"zoom_changed",function(){var b=google.maps.event.addListener(a.map,"bounds_changed",function(){this.getZoom()>e&&1==this.initialZoom&&(this.setZoom(e),this.initialZoom=!1),google.maps.event.removeListener(b)})}),a.map.fitBounds(a.bounds)},setInfoBox:function(a){var b,c=this,d="",e=a.name,f=(a.status,a.name),g=a.city+", "+a.state;b="none"==a.status?"":"<div class='SCMapInfoBox-company'>"+e+"</div>","none"!=a.status?(d='			<div class="SCMapInfoBox-icon '+a.status.toLowerCase().replace(" ","")+'">	',d+="			</div>",f=a.status):f=a.name;var h='									<table class="SCMapInfoBox clearfix">										<tbody>											<tr>												<td>													'+d+'												</td>												<td>													<div class="SCMapInfoBox-status">														'+f+"													</div>													"+b+'													<div class="SCMapInfoBox-location">														'+g+"													</div>												</td>											</tr>										</tbody>									</table>									",i=c.getInfoBoxDimensions(h),j=i[0],k=(i[1],0);k="none"==a.status?-100:-115;var l=104-j/2;c.infoBox.setOptions({disableAutoPan:!0,boxStyle:{whiteSpace:"nowrap"},content:h,zIndex:null,pixelOffset:new google.maps.Size(l,k),infoBoxClearance:new google.maps.Size(-80,50),isHidden:!1,enableEventPropagation:!1}),c.infoBox.open(c.map,a.marker);var m=c.infoBox.getPosition();google.maps.Map.prototype.panToWithOffset=function(a,b,c){var d=this,e=new google.maps.OverlayView;e.onAdd=function(){var e=this.getProjection(),f=e.fromLatLngToContainerPixel(a);f.x=f.x+b,f.y=f.y+c,d.panTo(e.fromContainerPixelToLatLng(f))},e.draw=function(){},e.setMap(this)},c.map.panToWithOffset(m,0,-30)},getInfoBoxDimensions:function(a){var b=$("<div>").html(a);$(b).appendTo("body").css({position:"absolute",left:"-9999px",top:"-9999px"});var c=$(b).width(),d=$(b).height();return $(b).remove(),new Array(c,d)},addMarkers:function(){{var a=this;new google.maps.Marker({position:new google.maps.LatLng(-25.363882,131.044922),map:a.map,title:"Hello World!"})}a.infoBox=new InfoBox;for(var b in d.companies)console.log("*Setting marker for company: "+d.companies[b].name+" at ("+d.companies[b].lat+", "+d.companies[b].lon+")"),d.companies[b].marker=new xMarker(new google.maps.LatLng(d.companies[b].lat,d.companies[b].lon),a.map,d.companies[b],d.companies[b].markerNumber),google.maps.event.addListener(d.companies[b].marker,"click",function(){a.setInfoBox(this.company)});document.addEventListener("click",function(){a.infoBox.close()},!0)}};return e}]),myApp.factory("Times",["Track",function(a){var b={timesActive:[],timesInactive:[],buttons:{},dates:[],hourOfDay:(new Date).getHours(),year:(new Date).getFullYear(),init:function(){this.setDays()},postify:function(){var a="";this.buttons.now?a+="&box41=now":this.buttons.anytime&&(a+="&box41=anytime");for(var b=0;b<this.timesActive.length;b++){var c=this.timesActive[b].replace("-","").split("").reverse().join(""),d=c[1]-1;a+="&box"+c+"="+this.dates[d].toString}return a},isFull:function(){var a=this.buttons.now?1:0;return this.timesActive.length+a>=5},fullAlert:function(){a.event(3,"maximum_time_slots_notification",!0),new xAlert("Please select a maximum of 5 times")},isEmpty:function(){function a(){for(var a in b.buttons)if(0!=b.buttons[a])return!1;return console.log("true"),!0}var b=this;return 0==this.timesActive.length&&a()},empty:function(){return this.buttons={},this.timesActive=[],this},changeTime:function(b){function c(){a.event(2,b+"_button_deselected",!0)}function d(){a.event(2,b+"_button_selected",!0)}return this.buttons[b]==b||"pick_time"==b?c():d(),"now"==b&&1==this.buttons.anytime&&(this.buttons.anytime=0),"now"==b&&this.isFull()&&!this.buttons.now?(this.fullAlert(),!1):"pick_time"==b?(this.buttons.pick_time=1,this.buttons.anytime=0,!0):(this.buttons[b]=!this.buttons[b],"anytime"==b&&1==this.buttons.anytime&&(this.empty(),this.buttons={anytime:1}),void("pick_time"==b&&1==this.buttons.pick_time&&(this.buttons.anytime=0)))},find:function(a,b){return-1!=this.timesActive.indexOf(a+"-"+b)},findInactive:function(a,b){return-1!=this.timesInactive.indexOf(a+"-"+b)},setDays:function(){function a(a,b){for(var c=a+"";c.length<b;)c="0"+c;return c}for(var b=this,c=new Date,d=["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun","Mon","Tue","Wed","Thu","Fri","Sat"],e=0;7>e;e++){var f=new Date;f.setDate(c.getDate()+e);var g=d[f.getUTCDay()],h=a(f.getUTCDate(),2),i=a(f.getUTCMonth()+1,2),j={day:g,date:h,month:i,toString:this.year+"-"+i+"-"+h};b.dates.push(j)}b.hourOfDay>=11&&b.timesInactive.push("1-1"),b.hourOfDay>=15&&b.timesInactive.push("1-2"),b.hourOfDay>=19&&b.timesInactive.push("1-3")},toggleTime:function(b,c){if(this.findInactive(b,c))return!1;console.log("*Toggling time:"+b+"-"+c);var d=this.timesActive.indexOf(b+"-"+c);if(-1==d?a.event(2,"time_selected",!0):-1!=d&&a.event(2,"time_deselected",!0),-1!=d||this.isFull()){if(-1==d&&this.isFull())return this.fullAlert(),!1;this.timesActive.splice(d,1),0==this.timesActive.length&&(this.buttons.pick_time=!1)}else this.timesActive.push(b+"-"+c)}};return b.init(),b}]),myApp.factory("Request",["$state","Track","Recording","$rootScope","SCAPI","$interval","$http","$q","Times","Uploader",function(a,b,c,d,e,f,g,h,i,j){var k={initialized:!1,companies:{},statuses:[],statusThrottle:[],numCompaniesAccepted:0,numCompaniesCalled:0,numCompaniesRejected:0,processing:!1,complete:!1,isDescriptionValid:function(){if(this.description){var a=/\b[^\s]+\b/g,b=this.description.match(a);if(b&&b.length>=7&&"Describe what you need help with in as much detail as possible..."!=self.description)return!0}return!1},reset:function(){i.empty(),c.reset(),j.reset(),this.pingStatusesStop(),this.verifiedTimeoutStop(),this.description="",this.id=!1,this.statuses=[],this.statusThrottle=[],this.numCompaniesCalled=0,this.numCompaniesRejected=0,this.numCompaniesAccepted=0,this.companies={},this.processing=!1,this.complete=!1},addCompany:function(){},getID:function(){return this.id},getCompanies:function(){return this.companies},getStatus:function(){return this.status},getDescription:function(){return this.description},setID:function(a){this.id=a},verifiedTimeoutStart:function(){var a=this;a.timeSpentWaiting=0,a.verifiedTimeout=f(function(){a.timeSpentWaiting++,60==a.timeSpentWaiting?(b.event(3,"verification_notification",!0),new xAlert("To ensure the highest quality matches your request needs to be verified, which may take up to 15 minutes. If you need service right away please call us at 1-877-987-SEVA (7382)")):900==a.timeSpentWaiting&&new xAlert("We're sorry, but your request was unsuccessful.  If you still need service you may try again, or call us at 1-877-987-SEVA (7382)")},1e3)},verifiedTimeoutStop:function(){this.timeSpentWaiting=0,f.cancel(this.verifiedTimeout)},setRequestStatusOverride:function(a){var b=this;b.requestStatusOverride=-1==a?0:$.parseJSON(a)},pingStatusesStart:function(){var a=this;k.processing=!0,a.verifiedTimeoutStart(),a.interval=f(function(){e.getRequestStatus().then(function(c){if(b.event(1,"company_status_api_success",!0),a.setStatusThrottle(c),a.statusThrottle.length>0&&!$.isEmptyObject(a.companies)){a.verifiedTimeoutStop();
var d=a.statusThrottle[0];if(0!=d.companyID){d.companyName=k.companies[d.companyID].name,d.location=k.companies[d.companyID].city+", "+k.companies[d.companyID].state,d.rel=k.companies[d.companyID].markerNumber,d.iconClass=d.requestStatusShort.toLowerCase().replace(" ",""),k.companies[d.companyID].status=d.requestStatusShort,a.statuses.unshift(d),"Calling"==d.requestStatusShort&&k.numCompaniesCalled++,"Declined"==d.requestStatusShort&&k.numCompaniesRejected++,"Accepted"==d.requestStatusShort&&(e.getRatings(k.companies[d.companyID]).then(function(){console.log("*All ratings for company have been retrieved"),b.event(1,"company_rating_api_success",!0)},function(){b.event(1,"company_rating_api_failed",!0)}),k.companies[d.companyID].accepted=1,k.companies[d.companyID].acceptedOrder=a.numCompaniesAccepted,a.numCompaniesAccepted++),a.statusThrottle.shift();try{a.GoogleMap.setInfoBox(k.companies[d.companyID])}catch(f){}}else a.requestComplete(),a.pingStatusesStop()}console.log("*The current throttle is: ",a.statusThrottle)},function(){b.event(1,"company_status_api_failed",!0)})},1e3)},requestComplete:function(){b.event(1,"request_complete",!0),a.go("summary"),this.complete=!0},pingStatusesStop:function(){k.processing=!1,f.cancel(this.interval)},submit:function(){var a=h.defer();return testing&&this.setID(112669),e.searchAction3().then(function(b){k.pingStatusesStart(),a.resolve(b)}),a.promise},setStatusThrottle:function(a){function b(a,b){for(var c=0;c<b.length;c++){var d=b[c];if(d.requestStatusID==a)return!0}return!1}console.log("Status throttle response is: "+a);for(var c=0;c<a.length;c++){var d=a[c];b(d.requestStatusID,this.statusThrottle)||b(d.requestStatusID,this.statuses)||this.statusThrottle.push(d)}},setCompanies:function(a){this.companies=a},setCategory:function(a){this.category=a},setStatus:function(a){this.status=a},setDescription:function(a){this.description=a}};return k}]),myApp.factory("Storage",["User","Request","$localStorage",function(a,b,c){var d={name:!1,email:!1,phone:!1,zip:!1,recordingModalDismissed:!1,saveUser:function(){this.name=a.name,this.email=a.email,this.phone=a.phone,this.set()},"import":function(){a.name=c.sc_user_name,a.email=c.sc_user_email,a.phone=c.sc_user_phone,a.zip=c.sc_user_zip,this.name=c.sc_user_name,this.email=c.sc_user_email,this.phone=c.sc_user_phone,this.zip=c.sc_user_zip,this.recordingModalDismissed=c.sc_recordingModalDismissed},saveZip:function(){this.zip=a.zipcode,this.set()},set:function(){c.sc_user_name=this.name,c.sc_user_email=this.email,c.sc_user_phone=this.phone,c.sc_user_zip=this.zip,c.sc_recordingModalDismissed=this.recordingModalDismissed},empty:function(){c.$reset()}};return d}]),myApp.factory("User",[function(){var a={nameValidate:/[a-zA-Z]{2,}/,emailValidate:/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/i,phoneValidate:/^((\([\d]{3}\))( [\d]{3}-))[\d]{4}|^[\d]{10}$/,getCategory:function(){return this.category},getCategoryID:function(){return this.categoryID},getZipcode:function(){return this.zipcode()},getName:function(){return this.name},getPhone:function(){return this.phone},getEmail:function(){return this.email},setCategory:function(a){this.category=a},setCategoryID:function(a){this.categoryID=a},setZipcode:function(a){this.zipcode=a},setName:function(a){this.name=a},setPhone:function(a){this.phone=a},setEmail:function(a){this.email=a},isNameValid:function(){return this.name&&this.nameValidate.test(this.getName())},isEmailValid:function(){return this.emailValidate.test(this.getEmail())},isPhoneValid:function(){return this.phoneValidate.test(this.getPhone())}};return a}]),myApp.factory("Overlay",[function(){var a={body:$("body"),isActive:!1,isActiveWithSpinner:!1,overlaySpinner:$("<div class='overlay-spinner'><div class='ajax_loader'></div><div class='overlay-text-wrapper'><div class='overlay-text hidden'></div></div></div>"),overlayBackground:$("<div class='overlay'></div>"),add:function(a,b){return a&&!this.isActiveWithSpinner?(this.isActiveWithSpinner=!0,this.isActive=!0,this.body.append($(this.overlayBackground).append(this.overlaySpinner))):this.isActive?this.isActive&&!a&&(this.isActiveWithSpinner=!1,this.overlaySpinner.remove()):(this.isActive=!0,this.body.append(this.overlayBackground)),b&&this.message(b),this},remove:function(){return $(".overlay-text").html("").addClass("hidden"),this.isActive=this.isActiveWithSpinner=!1,this.overlayBackground.remove(),this.overlaySpinner.remove(),this},message:function(a){return this.isActiveWithSpinner||this.add(1),$(".overlay-text").html(a).removeClass("hidden"),this}};return a}]),myApp.factory("Location",["User","$q","$http","Overlay","$timeout","$window","MapLoader","Track","$state",function(a,b,c,d,e,f,g,h,i){var j={busy:!1,complete:function(){h.event(i.current.name+"_location_delegate_success"),d.remove(),console.log("removing busy status from complete"),this.busy=!1},error:function(a){var b;1==a?b="location":2==a&&(b="geocoding"),h.event(i.current.name+"_"+b+"_delegate_failed"),console.log("removing busy status from err"),this.busy=!1,d.remove(),this.opt_initial_check||new xAlert("Unable to obtain location")},geoLocate:function(a){function c(){return g.loadMaps().then(function(){console.log("*MapLoader, all loaded"),j.resolve(!0)},function(){console.log("*MapLoader rejected: not loaded"),a?j.reject(!1):new xAlert("Please verify you are connected to the internet and retry",function(a){1==a?c():j.reject(!1)},"Location Services","Retry,Cancel")}),j.promise}var e=this;e.busy=!0,a||(h.event("interaction",i.current.name+"_locate_button_pressed"),d.message("Locating...")),e.opt_initial_check=a;var f=b.defer(),j=b.defer();return c().then(function(){navigator.geolocation.getCurrentPosition(function(a){h.event("location_permission_granted");var b=new google.maps.Geocoder,c=a.coords.latitude,d=a.coords.longitude,g=new google.maps.LatLng(c,d);b.geocode({latLng:g},function(a,b){if(b==google.maps.GeocoderStatus.OK){var c=a[0].address_components,d=c[c.length-1].long_name,g=d.match(/\b\d{5}\b/g);g&&g.length>=1?(h.event(i.current.name+"_geocoding_delegate_success"),console.log("*Geolocated to zipcode: "+d),e.complete(),f.resolve(d)):(e.error(2),f.resolve())}else e.error(2),f.resolve()})},function(a){a.code==a.PERMISSION_DENIED&&h.event("location_permission_denied"),e.error(1),f.resolve()},{timeout:4e3})},function(){e.busy=!1,f.resolve(!1)}),f.promise}};return j}]),myApp.factory("Categories",[function(){var a=[{id:"6745",name:"Test Spin"},{id:"13",name:"Accountants"},{id:"244",name:"Appliances Repair"},{id:"6746",name:"Auto Glass Repair"},{id:"479",name:"Auto Repair"},{id:"6747",name:"Bail Bonds"},{id:"6748",name:"Bus Rental"},{id:"6749",name:"Car Wash"},{id:"1075",name:"Carpet Cleaners"},{id:"4629",name:"Chiropractors"},{id:"1543",name:"Computer Repair"},{id:"1886",name:"Dentists"},{id:"6750",name:"Electricians"},{id:"2512",name:"Florists"},{id:"6752",name:"Furniture Upholstery"},{id:"6753",name:"Garage Door"},{id:"6754",name:"Garbage Removal"},{id:"2886",name:"Gyms & Fitness"},{id:"6771",name:"Handyman"},{id:"2999",name:"Heating and Cooling"},{id:"3515",name:"Landscapers"},{id:"364",name:"Lawyers - Bankruptcy"},{id:"360",name:"Lawyers - Family"},{id:"6755",name:"Lawyers - Traffic"},{id:"6756",name:"Limo Rental"},{id:"3674",name:"Locksmiths"},{id:"3735",name:"Maid Services"},{id:"3810",name:"Massage Therapy"},{id:"6757",name:"Moving & Storage"},{id:"6758",name:"Notaries"},{id:"4338",name:"Painters"},{id:"6759",name:"Party Planners"},{id:"4391",name:"Party Rental"},{id:"4431",name:"Personal Trainers"},{id:"6760",name:"Pest Control"},{id:"4509",name:"Physical Therapy"},{id:"4764",name:"Plumbers"},{id:"4990",name:"Real Estate"},{id:"6762",name:"Rent Office Furniture"},{id:"5223",name:"Roofers"},{id:"5609",name:"Snow Removal"},{id:"6764",name:"Tailors"},{id:"6765",name:"Tax Preparation"},{id:"5947",name:"Taxicabs"},{id:"6766",name:"Towing"},{id:"6770",name:"Tree Removal"},{id:"6767",name:"Tutors"},{id:"6008",name:"TV Repair"},{id:"6768",name:"Veterinarians"},{id:"6769",name:"Window Replacement"}];return a}]),String.prototype.toHHMMSS=function(){var a=parseInt(this,10),b=Math.floor(a/3600),c=Math.floor((a-3600*b)/60),d=a-3600*b-60*c;10>d&&(d="0"+d);var e=c+":"+d;return e},myApp.factory("Uploader",["$q","Track",function(a,b){var c={url:api_root+"components/audio-upload/upload.php",success:function(a){console.log("Code = "+a.responseCode),console.log("Response = "+a.response),console.log("Sent = "+a.bytesSent),b.event(1,"amazon_audio_upload_success",!0),c.uploadPromise.resolve(a)},fail:function(a){new xAlert("An error has occurred when sending your recording: Code = "+a.code),console.log("upload error source "+a.source),console.log("upload error target "+a.target),b.event(1,"amazon_audio_upload_failed",!0),c.uploadPromise.reject(a)},reset:function(){this.busy=!1},uploadRecording:function(b,c){var d=this;d.uploadPromise=a.defer();var e=encodeURI(d.url+"?"+$.param(c)),f=b;console.log("File url is: "+f);var g=new FileUploadOptions;g.fileKey="file",g.fileName=f.substr(f.lastIndexOf("/")+1),console.log("*The Url we're pinging for UPLOAD is: "+e),"iOS"==device.platform?g.mimeType="audio/wav":"Android"==device.platform&&(g.mimeType="audio/amr"),console.log("*Options mimetype: "+g.mimeType),g.chunkedMode=!1;var h=new FileTransfer;return h.upload(f,e,d.success,d.fail,g),d.uploadPromise.promise}};return c}]),myApp.factory("Recording",["Track","$timeout","$interval","User","$http","$q","$rootScope",function(a,b,c,d,e,f,g){var h={length:0,position:0,lengthToString:"",positionToString:"",playing:0,permissionsStatus:0,paused:0,initialized:!1,init:function(){var a=this;return a.initialized?void 0:(console.log("Attempting to initialize"),a.initialized=!0,a.setAudio(),a.initialPromise=f.defer(),window.requestFileSystem(LocalFileSystem.TEMPORARY,0,a.gotFS,function(){}),a.initialPromise.promise)},setAudio:function(a){this.mimeType=a?a:"Android"==window.device.platform?"audio/amr":"audio/wav";var b=this.mimeType.split("/");b=b[1],this.audioType=b,"wav"==this.audioType&&(this.audioType="aiff"),console.log("Set recording's mimeType to: '"+this.mimeType+"' and audioType to: '"+this.audioType+"'")},gotFS:function(a){a.root.getFile("sc_recording.wav",{create:!0,exclusive:!1},function(a){h.gotFileEntry(a)},function(){alert("fail")})},newMediaRec:function(){var a=this;if(console.log("Creating new media rec with src: "+a.toURL),"Android"==device.platform)var b=a.toURL;else var b=a.src;a.mediaRec=new Media(b,function(){},function(b){console.log("MediaError callback code: "+b.code),console.log("MediaError callback message: "+b.message),1==b.code&&(new xAlert("To record audio, please enable audio permissions for this application from your devices settings page.",function(){},"Recording Permissions Declined"),a.permissionsStatus=2)},function(b){console.log("*Recording status has changed to: "+b),2==b&&(a.permissionsStatus=1)})},gotFileEntry:function(a){var b=this;b.toURL=a.toURL(),b.src=a.fullPath,console.log("***Creating a media file at: "+a.fullPath),b.newMediaRec(),h.initialPromise.resolve(!0)},startRecord:function(){var b=this,d=f.defer();return b.saved?(b.playing&&b.pause(),new xAlert("Are you sure you want to delete the details recording?",function(c){1==c?(a.event(2,"delete_notification_ok",!0),b.mediaRec.release(),b.recording=!1,b.reset(),g.$apply(),d.resolve(b)):(a.event(2,"delete_notification_cancel",!0),d.resolve(b))},"Alert","Yes, No")):(b.mediaRec.startRecord(),b.interval=c(function(){1==b.permissionsStatus&&(b.recording=!0,b.length+=.1,b.lengthToString=b.length.toString().toHHMMSS(),console.log("*Recording Length: "+b.length))},100),d.resolve(b)),d.promise},stopRecord:function(b){var d=this;d.recording=!1,d.mediaRec.stopRecord(),d.playing&&d.stop(),c.cancel(d.interval),d.length<3&&"recording"!=testingType&&!b?(a.event(3,"audio_too_short_notification",!0),new xAlert("Recording must be at least 3 seconds"),d.reset()):(d.newMediaRec(),d.saved=!0)},toggleRecord:function(){var b=this;a.event(2,"record_button_pressed",!0),b.recording?b.recording&&(b.recording=!1,b.stopRecord()):b.startRecord()},togglePlay:function(){var b=this;b.playing?(a.event(2,"pause_button_pressed",!0),b.pause()):b.playing||(a.event(2,"play_button_pressed",!0),b.play())},play:function(){var a=this;a.playing=1,a.paused=0,a.mediaRec.play(),a.playInterval=c(function(){a.position+=.1,a.positionToString=a.position.toString().toHHMMSS(),a.position>=a.length&&a.stop()},100)},reset:function(){var a=this;console.log("*Recording.reset()"),a.position=0,a.playing=0,a.paused=0,a.length=0,a.recording=!1,a.saved=!1,a.positionToString="",a.lengthToString="",this.mediaRec&&(this.mediaRec.pause(),this.mediaRec.stop(),this.mediaRec.release())},rewind:function(){self.playing=0,self.paused=0},pause:function(){var a=this;a.mediaRec.pause(),a.paused=1,a.playing=0,c.cancel(a.playInterval)},stop:function(){var a=this;a.playing&&a.mediaRec.pause(),a.mediaRec.stop(),a.playing=0,a.paused=0,a.position=0,c.cancel(a.playInterval)}};return h}]),myApp.factory("Splash",["$q",function(a){var b={intervalLength:400,image:{src:"images/splash-plain.png"},images:{iphone4:["images/splash-iphone4-1.jpg","images/splash-iphone4-2.jpg","images/splash-iphone4-3.jpg","images/splash-iphone4-4.jpg"],iphone5:["images/splash-iphone5-1.jpg","images/splash-iphone5-2.jpg","images/splash-iphone5-3.jpg","images/splash-iphone5-4.jpg"]},remove:function(){clearInterval(this.blipInterval),navigator.splashscreen&&navigator.splashscreen.hide(),$("#splashscreen").hide()},blip:function(){var b,c,d=a.defer(),e=0,f=this;return device&&"iOS"==device.platform?(screen.height<=480?(b=document.getElementById("splashImg-iPhone4"),c=this.images.iphone4):(b=document.getElementById("splashImg-iPhone5"),c=this.images.iphone5),b.style.left=0,this.blipInterval=setInterval(function(){0==e?(b.src=c[0],navigator.splashscreen&&navigator.splashscreen.hide()):e==c.length?(f.remove(),d.resolve(!0)):b.src=c[e],e++},f.intervalLength)):(navigator.splashscreen.hide(),f.remove(),d.resolve(!0)),d.promise}};return b}]),angular.module("myApp.controllers",[]),myApp.controller("bodyController",["$location","$scope","Menu","AnimationService",function(a,b,c,d){a.path("statusBug"==testingType?"/statusBug":"/step1"),b.menu=c,b.click=function(){c.active=!1},b.animationService=d}]),myApp.controller("actionButtonController",["$scope","Track",function(a,b){a.click=function(a){b.event(2,a+"_button_pressed",!0)}}]),myApp.controller("wrapperController",["$scope","App","Storage","SCAPI","Categories","Track","$rootScope","Request","Nav","MapLoader","Location","User","$location",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(a){console.log("***locating...."),j.loadMaps().then(function(){l.zipcode||(console.log("*Going to geoLocate from wrapperController"),k.geoLocate(a).then(function(a){l.setZipcode(a)}))})}a.app=b,c.import(),d.init(h),a.categories=e,f.init(),f.event(1,"application_opened"),g.$on("$locationChangeSuccess",function(){console.log("*page*"+m.url()),f.event(1,m.url().replace("/","")+"_screen_opened"),i.reset()}),a.isPhoneGap=isPhoneGap;var o=480==window.screen.height,p=568==window.screen.height;o?a.iphone4=!0:p&&(a.iphone5=!0),n(1)}]),myApp.controller("step1Controller",["App","$scope","Location","User","Request","$location","Categories","Overlay","SCAPI","$q","Splash","$state","Track",function(a,b,c,d,e,f,g,h,i,j,k,l,m){e.reset(),b.app=a,b.isPhoneGap=isPhoneGap,b.Location=c,b.User=d,b.Request=e,b.$on("$viewContentLoaded",function(){a.loaded||(a.loaded=!0,isPhoneGap&&navigator.splashscreen.hide())}),b.change=function(){m.event(2,"category_selected",!0);for(var a=0;a<b.categories.length;a++)b.categories[a].id==e.categoryID&&e.setCategory(b.categories[a].name);console.log("*Set Request category ID to:"+e.categoryID),console.log("*Set Request category to:"+e.category)},setTimeout(function(){document.getElementById("disabled").disabled="yes"},1),b.getLocation=function(){console.log("*scope.getLocation"),h.add(1),c.geoLocate().then(function(a){console.log("Returned..."),b.Location.busy=!1,a&&b.User.setZipcode(a),h.remove()})},b.next=function(){if(skipAPICalls)return e.setID(testRequestID),void l.go("step2");var a=j.defer();return h.add(1),console.log("SCAPI: ",i),i.step1().then(function(b){h.remove(),console.log("*Step 1 Returned: ",b);b.split("|");if(-1==b.indexOf("requestID|")){var c={"Invalid Service Category":"invalid_category_notification","Invalid Location":"invalid_location_notification"};return m.event(3,"alert_"+c[b]),m.event("step1_service_search_delegate_failed"),new xAlert(b),!1}m.event("step1_service_search_delegate_success"),a.resolve(b),l.go("step2")}),a.promise};var n=f.search().source;if(n){for(var o=0;o<g.length;o++)g[o].name==n&&(e.categoryID=g[o].id);e.setCategory(n)}}]),myApp.controller("step2Controller",["Track","RecordingModal","Overlay","Uploader","$http","Recording","$timeout","SCAPI","Times","$scope","User","Request","$state","$interval",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(){l.submit().then(function(){c.remove(),m.go("step3")})}j.isPhoneGap=isPhoneGap,j.recordingModal=b,$.isEmptyObject(l.companies)&&h.getCompaniesList(),j.Times=i,j.Request=l,j.timetable=function(){m.go("timetable")},j.recordingSaved=f.saved,f.saved?(l.setDescription(""),$("textarea").attr("placeholder","Recording Saved").val("")):$("textarea").attr("placeholder","Describe what you need help with in as much detail as possible..."),j.next=function(){return skipAPICalls?(l.setDescription("This is a test description set by the skip API Calls variable"),i.buttons={now:!0},void m.go("step2a")):f.saved||l.isDescriptionValid()?i.isEmpty()?(new xAlert("Please select a time"),!1):void(k.isEmailValid()&&k.isNameValid()&&k.isPhoneValid()?new xAlert(alerts.call_companies.body,function(b){2==b?(a.event(2,"confirm_notification_ok",!0),c.add(1),f.saved?(c.message("Uploading Recording..."),d.uploadRecording(f.toURL,{audioType:f.audioType,reqID:l.id}).then(function(){console.log("*Audio Uploaded"),c.message("Encoding Recording..."),e({url:api_root+"api/mobile/v2/encodeAudio.php?audioType="+f.audioType+"&requestID="+l.id,method:"GET",headers:{"Content-Type":"application/json"}}).success(function(a){console.log("*Audio Encoding returned: "+a),c.message("Preparing Request..."),o()}).error(function(){new xAlert("Error Encoding Recording")})},function(){c.remove()})):(c.message("Preparing Request..."),o())):a.event(2,"confirm_notification_no",!0)},"Alert","Cancel,Ok"):m.go("step2a")):(new xAlert("Description must be 7 words"),!1)};var p=function(){"0px"==$(this).css("left")&&(g(function(){b.show()},1e3),$("#bodyContainer").unbind("transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd",p))};$("#bodyContainer").bind("transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd",p);var q=n(function(){b.hasBeenActive?n.cancel(q):"0px"==$("#bodyContainer").css("left")&&(b.show(),n.cancel(q))},1e3);if(isPhoneGap)var r=n(function(){f.initialized?n.cancel(r):"0px"==$("#bodyContainer").css("left")&&(f.init(),n.cancel(r))},1e3);j.$on("$destroy",function(){$("#bodyContainer").unbind("transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd")})}]),myApp.controller("step2aController",["Track","$http","Uploader","Overlay","Recording","Storage","$rootScope","User","Times","$scope","Request","$state","$window",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(){d.message("Preparing Request..."),k.submit().then(function(){d.remove(),l.go("step3")})}var o=angular.copy(h),p=g.$on("back",function(){h.setName(o.getName()),h.setEmail(o.getEmail()),h.setPhone(o.getPhone())});j.User=h,j.$watch("User.name",function(){!g.settingsCompletedOnce.name&&h.isNameValid()&&(a.event(2,"name_completed",!0),g.settingsCompletedOnce.name=!0)}),j.$watch("User.email",function(){!g.settingsCompletedOnce.email&&h.isEmailValid()&&(a.event(2,"email_completed",!0),g.settingsCompletedOnce.email=!0)}),j.$watch("User.phone",function(){!g.settingsCompletedOnce.phone&&h.isPhoneValid()&&(a.event(2,"phone_completed",!0),g.settingsCompletedOnce.phone=!0)}),j.Times=i,j.emailKeyup=function(a){a.stopPropagation(),console.log(a)};var q=function(){h.phone&&""!=h.phone&&(h.phone=String(parseInt(h.phone.replace(/[)( -]/g,""))))},r=function(){h.phone>0&&""!=h.phone&&"NaN"!=h.phone&&(h.phone=h.phone.replace(/([\d]{3})([\d]{3})([\d]{4})/,"($1) $2-$3")),"NaN"==h.phone&&(h.phone="")};j.$on("$destroy",function(){p()}),j.onPhoneFocus=q,j.onPhoneBlur=r,r(),j.next=function(){return skipAPICalls?(h.setName("This is a test name"),h.setEmail("test@test.test"),h.setPhone(testPhoneNumber),void n()):void(h.isNameValid()?h.isEmailValid()?h.isPhoneValid()?(f.saveUser(),o=angular.copy(h),!k.isDescriptionValid()&&!e.saved||i.isEmpty()?m.history.back():new xAlert(alerts.call_companies.body,function(f){2==f?(a.event(2,"confirm_notification_ok",!0),d.add(1),e.saved?(d.message("Uploading Recording..."),c.uploadRecording(e.toURL,{audioType:e.audioType,reqID:k.id}).then(function(){console.log("*Audio Uploaded"),d.message("Encoding Recording..."),b({url:api_root+"api/mobile/v2/encodeAudio.php?audioType=aiff&requestID="+k.id,method:"GET",headers:{"Content-Type":"application/json"}}).success(function(a){console.log("*Audio Encoding returned: "+a),d.message("Preparing Request..."),n()}).error(function(){new xAlert("Error Encoding Recording")})})):n()):a.event(2,"confirm_notification_no",!0)},"Alert","Cancel,Ok")):(a.event(3,"invalid_phone_notification",!0),new xAlert("Invalid phone number")):(a.event(3,"invalid_email_notification",!0),new xAlert("Invalid email")):(a.event(3,"invalid_name_notification",!0),new xAlert("Invalid name")))}}]),myApp.controller("step3Controller",["$urlRouter","$rootScope","$state","Nav","GoogleMap","Request","$scope",function(a,b,c,d,e,f,g){var h=b.$on("$stateChangeStart",function(b,d){function e(){return b.preventDefault(),f.alert=new xAlert(alerts.abandon.body,function(b){1==b&&(f.reset(),h(),c.go(d.name),a.sync()),console.log(b)},alerts.abandon.title,"Yes, Cancel"),!1}"summary"!=d.name&&"step1"!=d.name&&e()}),i=b.$on("$locationChangeStart",function(b,d){return-1==d.indexOf("step3")&&-1==d.indexOf("step1")&&-1==d.indexOf("summary")?(b.preventDefault(),f.alert=new xAlert(alerts.abandon.body,function(b){1==b&&(f.reset(),c.go("step1"),a.sync()),console.log(b)},alerts.abandon.title,"Yes, Cancel"),!1):void 0});g.$on("$destroy",function(){h(),i()}),f.complete&&(d.direction="forward"),g.companies=f.companies,g.request=f,e.init(),g.statuses=f.statuses}]),myApp.controller("summaryController",["TwitterService","Track","Request","SCAPI","$scope",function(a,b,c,d,e){a.init(),c.setID(112669),e.request=c,e.acceptanceRate=c.numCompaniesCalled?Math.round(parseFloat(c.numCompaniesAccepted/c.numCompaniesCalled*100))+"%":"0%",d.timeSaved().then(function(a){e.timeSaved=a.timeSaved}),e.twitterMessage=encodeURIComponent("talklocal found me help in minutes! talklocal.com #savetime #awesome @talklocal"),e.twttrURL="https://twitter.com/intent/tweet?url=http://www.talklocal.com&text="+encodeURIComponent("talklocal found me help in minutes! talklocal.com #savetime #awesome @talklocal"),e.twitterShare=function(){b.event(2,"twitter_share_button_pressed",!0)},e.facebookShare=function(){b.event(2,"facebook_share_button_pressed",!0);var a="http://facebook.com/dialog/feed";return a+="?app_id=696501850437286",a+="&link=http://talklocal.com",a+="&name= talklocal - Tell us what and when, we'll find the professionals!",a+="&description=talklocal works to find local businesses that can help you with your service need instantly, like a free personal concierge service. Within minutes you will be connected to providers that can service your specific problem, on your schedule, at your location.",a+="&redirect_uri=http://talklocal.com",console.log("popping up fb url: "+a),window.open("http://www.facebook.com/dialog/feed?app_id=696501850437286&link=http://talklocal.com&name="+encodeURIComponent("talklocal - Tell us what and when, we'll find the professionals!")+"&redirect_uri=http://talklocal.com","_system"),!1}}]),myApp.controller("menuController",["$rootScope","$parse","$attrs","$scope","Menu","Track","$state",function(a,b,c,d,e,f){d.Menu=e,a.$on("click",function(){e.active=!1}),d.click=function(a){f.event(2,a+"_button_pressed",!0)}}]),myApp.controller("headerController",["Track","Nav","Request","$rootScope","$state","$window","Menu","$attrs","$scope",function(a,b,c,d,e,f,g,h,i){i.request=c,i.$on("$stateChangeSuccess",function(a,b){"step1"==b.name?$("#nav").hide():$("#nav").show()}),i.navigation=b,i.nav=function(){"forward"==b.direction?(a.event(2,"forward_button_pressed",!0),d.$broadcast("forward"),e.go("summary")):(a.event(2,"back_button_pressed",!0),d.$broadcast("back"),f.history.back())},i.menuToggle=function(){g.active=1}}]),myApp.controller("timeTableController",["Times","$scope","$rootScope",function(a,b,c){b.Times=a,console.log("*Times object:"+a.postify());var d=angular.copy(a.timesActive),e=c.$on("back",function(){a.timesActive=d});b.$on("$destroy",function(){e()})}]),myApp.controller("informationController",["Track","$rootScope","Overlay","resolveSize","$scope","$window","Menu","$state",function(a,b,c,d,e,f,g,h){function i(){var a=$(".ui-view-container").width(),b=parseInt(a/16*9)+2;$(".video-box").css({height:b+"px","max-height":"400px"}),400>b?$(".video-box").css({width:"100%"}):(b=400,a=b/9*16,$(".video-box").css({width:a+"px"}))}var j=function(b){a.event(2,b+"_button_pressed",!0)};e.trackButton=j;var k=function(){"information"==h.current.name&&$("#sc-video").removeClass("hidden")},l=function(){console.log("*Adding iFrame on transition end"),"0px"==$(this).css("left")&&(k(),$("#bodyContainer").unbind("transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd",l))};$("#bodyContainer").bind("transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd",l),e.$on("$destroy",function(){$("#sc-video").addClass("hidden")}),$(".video-box").css({height:d[0]+"px",width:d[1]+"px"}),angular.element(f).bind("resize",function(){i()})}]),myApp.controller("recordingController",["$q","$urlRouter","$rootScope","$state","Recording","$scope",function(a,b,c,d,e,f){f.recording=e;var g=c.$on("$stateChangeStart",function(a){function d(){e.stopRecord(1),e.reset(),c.$apply(),a.preventDefault(),new xAlert("Recording must be at least 3 seconds",function(){b.sync()})}e.playing&&e.stop(),e.recording&&e.length<3?d():e.recording&&e.length>=3&&e.stopRecord()}),h=c.$on("$locationChangeStart",function(a,d){return e.playing&&e.stop(),-1==d.indexOf("recording")&&e.recording&&e.length<3?(e.stopRecord(1),e.reset(),c.$apply(),a.preventDefault(),new xAlert("Recording must be at least 3 seconds",function(){b.sync()}),!1):void(e.recording&&-1==d.indexOf("recording")&&e.stopRecord())});f.next=function(){e.playing&&e.stop(),e.recording?!e.recording||e.length>=3?(e.stopRecord(),d.go("step2")):e.recording&&e.length<3?(e.stopRecord(1),e.reset(),c.$apply(),event.preventDefault(),new xAlert("Recording must be at least 3 seconds",function(){b.sync()})):d.go("step2"):d.go("step2")},f.$on("$destroy",function(){g(),h()})}]),myApp.controller("splashController",["$scope","Splash",function(a,b){a.splash=b}]),angular.module("myApp.directives",[]).directive("appVersion",["version",function(a){return function(b,c){c.text(a)}}]).directive("scHeader",[function(){return{restrict:"EA",replace:!0,controller:"headerController",templateUrl:"views/header.html"}}]).directive("actionButton",["User",function(){return{restrict:"EA",replace:!0,controller:"actionButtonController",scope:{text:"=",clickfunction:"="},link:function(a,b){b.bind("click",function(){a.click(a.text)})},templateUrl:"views/button.html"}}]).directive("scMenu",[function(){return{restrict:"EA",replace:!0,controller:"menuController",templateUrl:"views/menu.html"}}]).directive("phoneInput",[function(){return{restrict:"EA",replace:!0,template:'<input id="phone" maxlength="10" type="tel" ng-model="User.phone"/>'}}]).directive("ios7StatusBar",[function(){return{restrict:"EA",replace:!0,controller:"ios7StatusBarController",templateUrl:"views/statusBar.html"}}]).directive("scBlur",["$parse","$timeout",function(a,b){return function(c,d,e){var f=a(e.scBlur);d.bind("blur",function(a){b(function(){c.$apply(function(){f(c,{$event:a})})})})}}]).directive("scFocus",["$parse","$timeout",function(a,b){return function(c,d,e){var f=a(e.scFocus);d.bind("focus",function(a){b(function(){c.$apply(function(){f(c,{$event:a})})})})}}]).directive("a",function(){return{restrict:"EAC",link:function(a,b,c){if(isPhoneGap){var d=c.href;b.on("click",function(a){window.open(d,"_system"),a.preventDefault()})}}}}).directive("customValidation",["User",function(){return{require:"ngModel",link:function(a,b,c,d){d.$parsers.push(function(a){var b=a.toLowerCase().replace(/[a-zA-Z\s]*/g,"");return b!=a&&(d.$setViewValue(b),d.$render()),b})}}}]),app.initialize(),isPhoneGap)document.addEventListener("deviceready",function(){angular.bootstrap(document,["myApp"])});else try{angular.bootstrap(document,["myApp"])}catch(e){console.error(e.stack||e.message||e)}